---
title: "æ—¢å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨åŒã˜åå‰ã® artifacts ã‚’ download-artifact ã™ã‚‹ã¨å¤±æ•—ã™ã‚‹ã€GitHub Actionsã€‘"
emoji: "ğŸ’«"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["githubactions"]
published: true
published_at: 2022-12-21 10:00
---

# æ¦‚è¦
GitHub Actions ã«ãŠã„ã¦ã€ç•°ãªã‚‹ã‚¸ãƒ§ãƒ–é–“ã§æˆæœç‰©ã‚’å…±æœ‰ã—ãŸã„ã¨ãã€ç­†è€…ã¯ `actions/upload-artifact`,`actions/download-artifact` ã‚’æ„›ç”¨ã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ã¦ã€**æ—¢å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨åŒã˜åå‰ã® artifacts ã‚’ download-artifact ã™ã‚‹**ã¨å¤±æ•—ã—ã¦ã—ã¾ã£ãŸãŸã‚ã€å†ç¾æ‰‹é †ã‚„è§£æ±ºç­–ã«ã¤ã„ã¦ã€å‚™å¿˜éŒ²ã¨ã—ã¦æ›¸ãç•™ã‚ã¦ãŠãã¾ã™ã€‚

:::message
å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä»¥ä¸‹ã‚’ã”å‚ç…§ãã ã•ã„ã€‚
- [actions/upload-artifact](https://github.com/actions/upload-artifact)
- [actions/download-artifact](https://github.com/actions/download-artifact)
:::

# å†ç¾æ‰‹é †
å†ç¾ã—ãŸã„ã®ã¯ã€`actions/upload-artifact`,`actions/download-artifact`ã‚’ä½¿ã£ã¦ã€ç•°ãªã‚‹ã‚¸ãƒ§ãƒ–[^1]é–“ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±æœ‰ã™ã‚‹éš›ã®ã‚¨ãƒ©ãƒ¼ã§ã™ã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
```markdown
â”œâ”€â”€ .github
â”‚Â Â  â””â”€â”€ workflows
â”‚Â Â      â”œâ”€â”€ fail_sample.yaml    # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆå¤±æ•—ä¾‹ï¼‰
â”‚Â Â      â””â”€â”€ success_sample.yaml # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆæˆåŠŸä¾‹ï¼‰
â”œâ”€â”€ sample                      # "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«"ã¨åŒåã®ãƒ‡ã‚¤ãƒ¬ã‚¯ãƒˆãƒª
â”‚Â Â  â””â”€â”€ .gitkeep
â””â”€â”€ upload
    â””â”€â”€ sample                  # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«
```
## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```yaml:fail_sample.yaml
name: fail_sample
on:
  push:
jobs:
  job_v2:
    runs-on: [ubuntu-22.04]
    steps:
      - uses: actions/checkout@v2
      # ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«(`upload/sample`)ã‚’ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³(`actions/upload-artifacts`)ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
      - uses: actions/upload-artifact@v2
        with:
          name: sample # is same as already existing directory name
          path: upload/sample
      # ã‚¢ã‚¯ã‚·ãƒ§ãƒ³(`actinos/download-artifacts`)ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
      - uses: actions/download-artifact@v2
        with:
          name: sample # is same as already existing directory name
      # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’è¡¨ç¤ºã™ã‚‹
      - name: show files exists
        run: cat sample/sample
        if: always()
```
# ã‚¨ãƒ©ãƒ¼å†…å®¹
ä¸Šè¨˜ã®`fail_sample.yaml`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä¸‹è¨˜ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

`Run actions/download-artifacts@v2` ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’è¦‹ã‚‹ã¨ã€`illegal operation on a directory, open path/to/xxx`ã¨ã‚ã‚Šã€`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å¯¾ã™ã‚‹ä¸å½“ãªæ“ä½œã§ã‚ã‚‹`ã¨æ€’ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯`sample`ã¨ã„ã†åå‰ã® artifact ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã—ãŸãŒã€`sample` ã¨ã„ã†åŒåã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒæ—¢ã«ã‚ã‚‹ãŸã‚ã§ã™ã€‚

```sh
> Run actions/download-artifact@v2
Starting download for sample
Directory structure has been setup for the artifact
Total number of files that will be downloaded: 1
node:events:368
      throw er; // Unhandled 'error' event
      ^

Error: EISDIR: illegal operation on a directory, open '/home/runner/work/duplication_name_bug_for_download_artifacts_action/duplication_name_bug_for_download_artifacts_action/sample'
Emitted 'error' event on WriteStream instance at:
    at emitErrorNT (node:internal/streams/destroy:157:8)
    at emitErrorCloseNT (node:internal/streams/destroy:122:3)
    at processTicksAndRejections (node:internal/process/task_queues:83:21) {
  errno: -21,
  code: 'EISDIR',
  syscall: 'open',
  path: '/home/runner/work/duplication_name_bug_for_download_artifacts_action/duplication_name_bug_for_download_artifacts_action/sample'
}
```
# è§£æ±ºç­–
åŒåã®ãƒ•ã‚©ãƒ«ãƒ€ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ãŒè«¸æ‚ªã®æ ¹æºã§ã™ã€‚ã‚ˆã£ã¦ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯¾è±¡ã‹æ—¢å­˜ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã©ã¡ã‚‰ã‹ã®åå‰ã‚’å¤‰ãˆã‚Œã°è§£æ±ºã§ã™ã€‚

## ã€æˆåŠŸã€‘ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯¾è±¡ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ã®åå‰/ä½ç½®ã‚’å¤‰ãˆã‚‹
download-artifact ã® path ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¾ã™ã€‚
```diff yaml:success_sample.yaml
    - uses: actions/download-artifact@v2
        with:
        name: sample # is same as already existing directory name
+       path: ./sample/ # to avoid name duplication error
```
ã“ã®å¤‰æ›´ã«ã‚ˆã‚Šã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒæˆåŠŸã—ã¾ã™ã€‚
```shell
Artifact sample was downloaded to /home/runner/work/duplication_name_bug_for_download_artifacts_action/duplication_name_bug_for_download_artifacts_action/sample
Artifact download has finished successfully
```

## ã€æœªæ¤œè¨¼ã€‘æ—¢å­˜ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®åå‰ã‚’å¤‰ãˆã‚‹
çœç•¥

## ã€å¤±æ•—ã€‘ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯¾è±¡ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®åå‰ã‚’å¤‰ãˆã‚‹
ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®åå‰ã‚’å¤‰ãˆã¦ã¿ã¾ã—ãŸãŒã€ãƒ€ãƒ¡ã§ã—ãŸã€‚
```diff yaml:fail_sample.yaml
    - uses: actions/upload-artifact@v2
      with:
-       name: sample # is same as already existing directory name
+       name: sample_binary # is not same ...
        path: upload/sample

    - uses: actions/download-artifact@v2
      with:
-       name: sample # is same as already existing directory name
+       name: sample_binary # is not same ...

    - name: check files exists
-     run: cat sample/sample
+     run: cat sample_binary/sample
```
### ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
ä¸Šè¨˜ã®ã‚¨ãƒ©ãƒ¼ã¨è‹¥å¹²é•ã†ã‚‚ã®ã®ã€ç—‡çŠ¶ã¨ã—ã¦ã¯åŒã˜æ§˜ã§ã™ã€‚
```sh
> Run actions/download-artifact@v2
Starting download for sample_binary
Directory structure has been setup for the artifact
Total number of files that will be downloaded: 1
events.js:291
      throw er; // Unhandled 'error' event
      ^

Error: EISDIR: illegal operation on a directory, open '/home/runner/work/duplication_name_bug_for_download_artifacts_action/duplication_name_bug_for_download_artifacts_action/sample'
Emitted 'error' event on WriteStream instance at:
    at internal/fs/streams.js:361:12
    at FSReqCallback.oncomplete (fs.js:156:23) {
  errno: -21,
  code: 'EISDIR',
  syscall: 'open',
  path: '/home/runner/work/duplication_name_bug_for_download_artifacts_action/duplication_name_bug_for_download_artifacts_action/sample'
}
```

# ç’°å¢ƒæƒ…å ±
## ä»Šå›ä½¿ç”¨ã—ãŸã‚½ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰
- [rokkish/duplication_name_bug_for_download_artifacts_action](https://github.com/rokkish/duplication_name_bug_for_download_artifacts_action)
## ä»Šå›ä½¿ç”¨ã—ãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸€è¦§
```sh
# v2ç³»
Download action repository 'actions/checkout@v2' (SHA:dc323e67f16fb5f7663d20ff7941f27f5809e9b6)
Download action repository 'actions/upload-artifact@v2' (SHA:82c141cc518b40d92cc801eee768e7aafc9c2fa2)
Download action repository 'actions/download-artifact@v2' (SHA:f023be2c48cc18debc3bacd34cb396e0295e2869)
# v3ç³»
Download action repository 'actions/checkout@v3' (SHA:755da8c3cf115ac066823e79a1e1788f8940201b)
Download action repository 'actions/upload-artifact@v3' (SHA:83fd05a356d7e2593de66fc9913b3002723633cb)
Download action repository 'actions/download-artifact@v3' (SHA:9782bd6a9848b53b110e712e20e42d89988822b7)
```

# ãã®ä»–: actions/download-artifact ã® Issue ã«ç™»éŒ²ã—ãŸæ–¹ãŒã‚ˆã•ãã†
- ã–ã£ã¨è¦‹ãŸã¨ã“ã‚Issueã€PRã«ã¯ä¸ŠãŒã£ã¦ã¯ãªã•ãã†ã€‚
- v3(SHA:9782bd6a9848b53b110e712e20e42d89988822b7)ã§ã‚‚å†ç¾ã—ãŸã€‚
- å…ƒæ°—ãŒã‚ã‚Œã°ã‚„ã‚Šã¾ã™ğŸ« 

[^1]: ä¾‹ã§ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’çŸ­ãã™ã‚‹ãŸã‚åŒä¸€ã‚¸ãƒ§ãƒ–ã¨ã—ã¦ã„ã¾ã™
